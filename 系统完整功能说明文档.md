# 图书馆座位预约信息管理系统 - 完整功能说明

## 📋 系统概述

图书馆座位预约信息管理系统是一个基于Spring Boot + Vue.js的全栈Web应用，支持移动端学生预约和PC端管理员管理功能。系统采用前后端分离架构，提供完整的座位预约管理解决方案。

## 🏗️ 技术架构

### 后端技术栈
- **框架**: Spring Boot 2.7.18
- **数据库**: MySQL 5.7+
- **ORM**: MyBatis Plus 3.5.3.1
- **JDK版本**: JDK 8+
- **工具库**: Hutool
- **定时任务**: Spring Task Scheduler

### 前端技术栈
- **框架**: Vue.js 2.6.14
- **PC端UI**: Element UI 2.15.9
- **移动端UI**: Vant 2.12.54
- **HTTP客户端**: Axios 0.27.2
- **状态管理**: Vuex 3.6.2
- **路由管理**: Vue Router 3.5.1
- **二维码生成**: QRCode.js 1.5.3

## 🎯 核心功能模块

### 1. 用户认证与权限管理

#### 1.1 用户注册与登录
- **学生注册**: 移动端用户注册，自动设置为学生类型
- **用户登录**: 支持学生和管理员登录，自动跳转对应界面
- **权限验证**: 前端路由守卫 + 后端Session验证
- **密码加密**: MD5加密存储用户密码

#### 1.2 用户类型管理
- **学生用户**: 可以预约座位、查看预约记录、取消预约
- **管理员用户**: 可以管理所有系统功能
- **权限控制**: 基于用户类型的功能访问控制

### 2. 移动端功能（学生端）

#### 2.1 用户管理
- **用户注册** (`/mobile/register`)
  - 填写用户名、密码、真实姓名、手机号、邮箱
  - 自动验证用户名唯一性
  - 注册成功自动跳转登录页

- **用户登录** (`/mobile/login`)
  - 用户名密码登录
  - 登录状态保持
  - 自动跳转到首页

#### 2.2 座位预约功能
- **预约首页** (`/mobile/home`)
  - 选择预约日期（当天及未来7天）
  - 选择预约时间段（8:00-22:00，按小时选择）
  - 选择图书馆
  - 查看可用座位并选择
  - 确认预约信息

- **预约规则**
  - 同一用户同一时间段只能预约一个座位
  - 同一座位同一时间段只能被一个用户预约
  - 不能预约过去的时间
  - 预约时间精确到小时

#### 2.3 预约记录管理
- **我的预约** (`/mobile/my-reservations`)
  - 查看所有预约记录
  - 按状态筛选：已预约、已使用、爽约、已取消
  - 支持取消未开始的预约
  - 显示预约详细信息

- **二维码生成** (`/mobile/qrcode/:orderNo`)
  - 为每个预约生成唯一二维码
  - 包含预约流水号信息
  - 用于管理员扫码验证

### 3. PC端管理功能（管理员端）

#### 3.1 管理员登录
- **管理员登录** (`/admin/login`)
  - 管理员账号密码登录
  - 权限验证
  - 登录成功跳转到管理面板

#### 3.2 系统管理面板
- **管理面板** (`/admin/dashboard`)
  - 统一的管理界面布局
  - 左侧导航菜单
  - 顶部用户信息和退出功能
  - 主内容区域显示各功能模块

#### 3.3 图书馆管理
- **图书馆管理** (`/admin/dashboard/libraries`)
  - **查看功能**: 分页显示所有图书馆
  - **搜索功能**: 按图书馆名称搜索
  - **新增功能**: 添加新图书馆（名称、地址、描述）
  - **编辑功能**: 修改图书馆信息
  - **删除功能**: 删除图书馆（级联检查）
  - **状态管理**: 启用/停用图书馆

#### 3.4 座位管理
- **座位管理** (`/admin/dashboard/seats`)
  - **查看功能**: 分页显示所有座位
  - **筛选功能**: 按图书馆、座位类型、状态筛选
  - **批量创建**: 支持批量创建座位
  - **编辑功能**: 修改座位信息
  - **删除功能**: 删除座位
  - **状态管理**: 正常/维修/停用状态切换

#### 3.5 预约记录管理
- **预约管理** (`/admin/dashboard/reservations`)
  - **查看功能**: 分页显示所有预约记录
  - **搜索功能**: 按用户姓名、图书馆、座位号、状态搜索
  - **取消预约**: 管理员可以取消任何预约
  - **状态查看**: 查看预约状态变化
  - **详细信息**: 查看预约完整信息

#### 3.6 用户管理 ⭐
- **用户管理** (`/admin/dashboard/users`)
  - **查看功能**: 分页显示所有用户
  - **搜索功能**: 按用户名、真实姓名、用户类型、状态搜索
  - **状态管理**: 启用/禁用用户账户
  - **类型修改**: 修改用户类型（学生↔管理员）
  - **权限控制**: 只有管理员可以操作

#### 3.7 扫码验证
- **二维码扫描** (`/admin/dashboard/scanner`)
  - **扫码功能**: 使用摄像头扫描学生预约二维码
  - **验证功能**: 验证预约有效性
  - **签到功能**: 确认学生签到，更新预约状态
  - **手动输入**: 支持手动输入流水号验证

### 4. 系统自动化功能

#### 4.1 定时任务系统
- **即将过期预约处理**
  - **执行频率**: 每10分钟执行一次
  - **处理逻辑**: 查询超过"预约结束时间前20分钟"的预约
  - **状态更新**: 将状态从"已预约"改为"爽约"
  - **业务场景**: 预约15:00结束，14:40后未签到标记为爽约

- **已过期预约处理（兜底机制）**
  - **执行频率**: 每60分钟执行一次
  - **处理逻辑**: 查询已超过结束时间的预约
  - **状态更新**: 确保所有过期预约都被正确处理
  - **容错机制**: 防止定时任务遗漏的情况

#### 4.2 流水号生成系统
- **自动生成**: 预约时自动生成唯一流水号
- **格式规则**: 日期 + 序号（如：20241213001）
- **序号重置**: 每日凌晨自动重置序号
- **唯一性保证**: 确保流水号全局唯一

#### 4.3 冲突检测系统
- **时间冲突检测**: 防止同一座位时间重叠预约
- **用户冲突检测**: 防止同一用户重复预约
- **实时验证**: 预约提交时实时检测冲突

## 🗄️ 数据库设计

### 核心数据表

#### 1. 用户表 (user)
```sql
- id: 用户ID（主键，自增）
- username: 用户名（唯一）
- password: 密码（MD5加密）
- real_name: 真实姓名
- phone: 手机号
- email: 邮箱
- user_type: 用户类型（学生/管理员）
- status: 状态（正常/禁用）
- create_time: 创建时间
- update_time: 更新时间
```

#### 2. 图书馆表 (library)
```sql
- id: 图书馆ID（主键，自增）
- name: 图书馆名称
- address: 地址
- description: 描述
- status: 状态（正常/停用）
- create_time: 创建时间
- update_time: 更新时间
```

#### 3. 座位表 (seat)
```sql
- id: 座位ID（主键，自增）
- library_id: 图书馆ID（外键）
- seat_number: 座位编号
- seat_type: 座位类型（普通座位/电脑座位）
- status: 状态（正常/维修/停用）
- create_time: 创建时间
- update_time: 更新时间
```

#### 4. 预约记录表 (reservation)
```sql
- id: 预约ID（主键，自增）
- order_no: 预约流水号（唯一）
- user_id: 用户ID（外键）
- library_id: 图书馆ID（外键）
- seat_id: 座位ID（外键）
- start_time: 预约开始时间
- end_time: 预约结束时间
- status: 状态（已预约/已使用/爽约/已取消）
- qr_code: 二维码内容
- check_in_time: 签到时间
- create_time: 创建时间
- update_time: 更新时间
```

#### 5. 系统配置表 (system_config)
```sql
- id: 配置ID（主键，自增）
- config_key: 配置键
- config_value: 配置值
- description: 描述
- create_time: 创建时间
- update_time: 更新时间
```

## 🔌 API接口文档

### 1. 认证接口 (AuthController)
```
POST /auth/login          # 用户登录
POST /auth/register       # 用户注册
POST /auth/logout         # 用户登出
GET  /auth/current        # 获取当前用户信息
```

### 2. 图书馆接口 (LibraryController)
```
GET    /library/list      # 获取图书馆列表
GET    /library/page      # 分页查询图书馆
POST   /library           # 新增图书馆
PUT    /library/{id}      # 更新图书馆
DELETE /library/{id}      # 删除图书馆
```

### 3. 座位接口 (SeatController)
```
GET    /seat/library/{libraryId}  # 获取图书馆座位列表
GET    /seat/available            # 获取可用座位
GET    /seat/page                 # 分页查询座位
POST   /seat                      # 新增座位
POST   /seat/batch                # 批量创建座位
PUT    /seat/{id}                 # 更新座位
DELETE /seat/{id}                 # 删除座位
```

### 4. 预约接口 (ReservationController)
```
POST /reservation                    # 创建预约
PUT  /reservation/{id}/cancel       # 取消预约
POST /reservation/checkin           # 扫码签到
GET  /reservation/page              # 分页查询预约记录
GET  /reservation/order/{orderNo}   # 根据流水号查询预约
GET  /reservation/detail/{orderNo}  # 查询预约详情
```

### 5. 用户管理接口 (UserController) ⭐
```
GET /user/page                    # 分页查询用户列表
PUT /user/{id}/toggle-status      # 切换用户状态
PUT /user/{id}/change-type        # 修改用户类型
```

### 6. 定时任务接口 (TaskController)
```
POST /task/handleSoonExpired      # 手动触发即将过期预约处理
POST /task/handleExpired          # 手动触发已过期预约处理
```

## 🎨 用户界面设计

### 移动端界面 (Vant UI)
- **响应式设计**: 适配各种移动设备屏幕
- **触摸友好**: 大按钮、易点击的交互元素
- **简洁明了**: 专注核心预约功能
- **流畅体验**: 页面切换动画和加载提示

### PC端界面 (Element UI)
- **管理面板**: 专业的后台管理界面
- **数据表格**: 支持排序、筛选、分页的数据展示
- **表单组件**: 丰富的表单控件和验证
- **操作反馈**: 完善的消息提示和确认对话框

## 🔒 安全特性

### 1. 认证与授权
- **Session管理**: 基于Session的用户状态管理
- **权限验证**: 前端路由守卫 + 后端接口权限验证
- **自动登出**: 长时间无操作自动登出

### 2. 数据安全
- **密码加密**: MD5加密存储用户密码
- **SQL注入防护**: 使用MyBatis参数化查询
- **XSS防护**: 前端输入验证和转义

### 3. 业务安全
- **冲突检测**: 防止重复预约和时间冲突
- **状态验证**: 严格的预约状态流转控制
- **操作确认**: 重要操作需要用户确认

## 📊 系统监控与日志

### 1. 定时任务监控
- **执行日志**: 详细记录定时任务执行情况
- **异常处理**: 完善的异常捕获和日志记录
- **性能监控**: 记录任务执行时间和处理数量

### 2. 业务日志
- **用户操作**: 记录关键用户操作
- **系统事件**: 记录系统重要事件
- **错误日志**: 详细的错误信息和堆栈跟踪

## 🚀 部署与运维

### 1. 环境要求
- **JDK**: 8+
- **MySQL**: 5.7+
- **Node.js**: 14+
- **Maven**: 3.6+

### 2. 部署步骤
1. **数据库初始化**: 执行database_design.sql
2. **后端部署**: Maven编译打包，Spring Boot启动
3. **前端部署**: npm构建，静态文件部署
4. **配置检查**: 数据库连接、跨域配置等

### 3. 运维监控
- **健康检查**: 定期检查服务状态
- **数据备份**: 定期备份数据库
- **日志轮转**: 防止日志文件过大
- **性能监控**: 监控系统资源使用情况

## 📈 系统特色功能

### 1. 智能预约系统
- **实时可用性**: 实时显示座位可用状态
- **冲突预防**: 多层次冲突检测机制
- **自动处理**: 定时任务自动处理过期预约

### 2. 移动优先设计
- **设备自适应**: 自动识别设备类型跳转对应界面
- **触摸优化**: 专为移动设备优化的交互体验
- **离线支持**: 关键功能支持离线使用

### 3. 管理员工具
- **批量操作**: 支持批量创建座位等操作
- **数据导出**: 支持预约数据导出
- **实时监控**: 实时查看系统使用情况

### 4. 扩展性设计
- **模块化架构**: 功能模块独立，易于扩展
- **配置化管理**: 关键参数支持配置化
- **API标准化**: RESTful API设计，易于集成

## 🔧 开发与维护

### 1. 代码规范
- **后端**: 遵循Spring Boot最佳实践
- **前端**: 遵循Vue.js官方风格指南
- **数据库**: 规范的表结构和索引设计

### 2. 测试策略
- **单元测试**: 核心业务逻辑单元测试
- **集成测试**: API接口集成测试
- **用户测试**: 完整的用户场景测试

### 3. 文档维护
- **API文档**: 详细的接口文档
- **部署文档**: 完整的部署指南
- **用户手册**: 面向最终用户的使用手册

---

## 📞 技术支持

如需技术支持或有任何问题，请参考：
- 项目README.md
- 故障排除文档 (TROUBLESHOOTING.md)
- API接口文档
- 数据库设计文档

**系统版本**: v1.0.0  
**最后更新**: 2024年12月13日  
**文档版本**: v1.0